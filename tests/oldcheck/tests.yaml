tests:
  - name: This
    model: |
      type document
        relations
          define viewer as self
    tuples:
      - object: document:1
        relation: viewer
        user: aardvark
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:1
          relation: viewer
          user: badger
        expectation: false

  - name: ComputedUserset
    model: |
      type document
        relations
          define writer as self
          define viewer as writer
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: writer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: aardvark
        expectation: false

  - name: TupleToUserset
    model: |
      type folder
        relations
          define viewer as self
      type document
        relations
          define parent as self
          define viewer as viewer from parent
    tuples:
      - object: document:1
        relation: parent
        user: folder:x
      - object: folder:x
        relation: viewer
        user: aardvark
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true

  - name: ThisAndUnion
    model: |
      type document
        relations
          define writer as self
          define viewer as self or writer
    tuples:
      - object: document:1
        relation: viewer
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true

  - name: ThisAndIntersection
    model: |
      type document
        relations
          define writer as self
          define viewer as self and writer
    tuples:
      - object: document:1
        relation: viewer
        user: aardvark
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:2
        relation: viewer
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: cheetah
        expectation: false

  - name: ThisAndExclusionBase
    model: |
      type document
        relations
          define writer as self
          define viewer as self but not writer
    tuples:
      - object: document:1
        relation: viewer
        user: aardvark
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:2
        relation: viewer
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: cheetah
        expectation: false

  - name: ComputedUsersetAndUnion
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define viewer as writer or editor
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:2
        relation: editor
        user: badger
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true

  - name: ComputedUsersetAndIntersection
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define viewer as writer and editor
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:3
        relation: editor
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false

  - name: ComputedUsersetAndExclusion
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define viewer as writer but not editor
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:3
        relation: editor
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false

  - name: TupleToUsersetAndComputedUserset
    model: |
      type folder
        relations
          define writer as self
          define viewer as writer
      
      type document
        relations
          define parent as self
          define viewer as viewer from parent
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: writer
        user: aardvark
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true

  - name: TupleToUsersetAndTupleToUserset
    model: |
      type group
        relations
          define member as self
      
      type folder
        relations
          define parent as self
          define viewer as member from parent
      
      type document
        relations
          define parent as self
          define viewer as viewer from parent
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: parent
        user: group:G
      - object: group:G
        relation: member
        user: aardvark
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true

  - name: TupleToUsersetAndUnion
    model: |
      type folder
        relations
          define writer as self
          define editor as self
          define viewer as writer or editor
      
      type document
        relations
          define parent as self
          define viewer as viewer from parent
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: writer
        user: aardvark
      - object: folder:X
        relation: editor
        user: badger
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:1
          relation: viewer
          user: badger
        expectation: true

  - name: TupleToUsersetAndIntersection
    model: |
      type folder
        relations
          define writer as self
          define editor as self
          define viewer as writer and editor

      type document
        relations
          define parent as self
          define viewer as viewer from parent
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: writer
        user: aardvark
      - object: folder:X
        relation: editor
        user: aardvark
      - object: folder:X
        relation: writer
        user: badger
      - object: folder:X
        relation: editor
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:1
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:1
          relation: viewer
          user: cheetah
        expectation: false

  - name: TupleToUsersetAndExclusion
    model: |
      type folder
        relations
          define writer as self
          define editor as self
          define viewer as writer but not editor

      type document
        relations
          define parent as self
          define viewer as viewer from parent
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: writer
        user: aardvark
      - object: folder:X
        relation: editor
        user: aardvark
      - object: folder:X
        relation: writer
        user: badger
      - object: folder:X
        relation: editor
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:1
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:1
          relation: viewer
          user: cheetah
        expectation: false

  - name: UnionAndTupleToUserset
    model: |
      type folder
        relations
          define viewer as self

      type document
        relations
          define parent as self
          define writer as self
          define viewer as writer or (viewer from parent)
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: viewer
        user: aardvark
      - object: document:1
        relation: writer
        user: badger
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:1
          relation: viewer
          user: badger
        expectation: true

  - name: UnionAndUnion
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer or (editor or owner)
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:2
        relation: editor
        user: badger
      - object: document:3
        relation: owner
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: true

  - name: UnionAndIntersection
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer or (editor and owner)
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:2
        relation: editor
        user: badger
      - object: document:2
        relation: owner
        user: badger
      - object: document:3
        relation: editor
        user: cheetah
      - object: document:4
        relation: owner
        user: duck
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false
      - tuple:
          object: document:4
          relation: viewer
          user: duck
        expectation: false

  - name: UnionAndExclusion
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer or (editor but not owner)
    tuples:
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:1
        relation: editor
        user: badger
      - object: document:2
        relation: owner
        user: badger
      - object: document:3
        relation: editor
        user: cheetah
      - object: document:4
        relation: owner
        user: duck
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: true
      - tuple:
          object: document:4
          relation: viewer
          user: duck
        expectation: false

  - name: IntersectionAndTupleToUserset
    model: |
      type folder
        relations
          define viewer as self
      
      type document
        relations
          define parent as self
          define writer as self
          define viewer as writer and (viewer from parent)
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: viewer
        user: aardvark
      - object: document:1
        relation: writer
        user: aardvark
      - object: folder:X
        relation: viewer
        user: badger
      - object: document:2
        relation: writer
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:1
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: cheetah
        expectation: false

  - name: IntersectionAndUnion
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer and (editor or owner)
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: owner
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
      - object: document:4
        relation: editor
        user: duck
      - object: document:5
        relation: owner
        user: eagle
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false
      - tuple:
          object: document:4
          relation: viewer
          user: duck
        expectation: false
      - tuple:
          object: document:5
          relation: viewer
          user: eagle
        expectation: false

  - name: IntersectionAndIntersection
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer and (editor and owner)
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:1
        relation: owner
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: editor
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
      - object: document:3
        relation: owner
        user: cheetah
      - object: document:4
        relation: writer
        user: duck
      - object: document:5
        relation: editor
        user: eagle
      - object: document:6
        relation: owner
        user: fox
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false
      - tuple:
          object: document:4
          relation: viewer
          user: duck
        expectation: false
      - tuple:
          object: document:5
          relation: viewer
          user: eagle
        expectation: false
      - tuple:
          object: document:6
          relation: viewer
          user: fox
        expectation: false

  - name: IntersectionAndExclusion
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer and (editor but not owner)
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:1
        relation: owner
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: editor
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
      - object: document:3
        relation: owner
        user: cheetah
      - object: document:4
        relation: writer
        user: duck
      - object: document:5
        relation: editor
        user: eagle
      - object: document:6
        relation: owner
        user: fox
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false
      - tuple:
          object: document:4
          relation: viewer
          user: duck
        expectation: false
      - tuple:
          object: document:5
          relation: viewer
          user: eagle
        expectation: false
      - tuple:
          object: document:6
          relation: viewer
          user: fox
        expectation: false

  - name: ExclusionAndComputedUnion
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define viewer as writer but not editor
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:3
        relation: editor
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false

  - name: ExclusionAndTupleToUsersetInBase
    model: |
      type folder
        relations
          define viewer as self
      
      type document
        relations
          define parent as self
          define writer as self
          define viewer as (viewer from parent) but not writer
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: viewer
        user: aardvark
      - object: document:1
        relation: writer
        user: aardvark
      - object: folder:X
        relation: viewer
        user: badger
      - object: document:2
        relation: writer
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:1
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: cheetah
        expectation: false

  - name: ExclusionAndTupleToUsersetInSubtract
    model: |
      type folder
        relations
          define viewer as self

      type document
        relations
          define parent as self
          define writer as self
          define viewer as writer but not (viewer from parent)
    tuples:
      - object: document:1
        relation: parent
        user: folder:X
      - object: folder:X
        relation: viewer
        user: aardvark
      - object: document:1
        relation: writer
        user: aardvark
      - object: folder:X
        relation: viewer
        user: badger
      - object: document:2
        relation: writer
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:1
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: cheetah
        expectation: true

  - name: ExclusionAndUnionInBase
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as (writer or editor) but not owner
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:1
        relation: owner
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: owner
        user: badger
      - object: document:3
        relation: editor
        user: cheetah
      - object: document:3
        relation: owner
        user: cheetah
      - object: document:4
        relation: writer
        user: duck
      - object: document:5
        relation: editor
        user: eagle
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false
      - tuple:
          object: document:4
          relation: viewer
          user: duck
        expectation: true
      - tuple:
          object: document:5
          relation: viewer
          user: eagle
        expectation: true

  - name: ExclusionAndUnionInSubtract
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer but not (editor or owner)
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: owner
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: true

  - name: ExclusionAndIntersectionInBase
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as (writer and editor) but not owner
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:1
        relation: owner
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: editor
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
      - object: document:4
        relation: editor
        user: duck
      - object: document:5
        relation: owner
        user: eagle
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: false
      - tuple:
          object: document:4
          relation: viewer
          user: duck
        expectation: false
      - tuple:
          object: document:5
          relation: viewer
          user: eagle
        expectation: false

  - name: ExclusionAndIntersectionInSubtract
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer but not (editor and owner)
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:1
        relation: owner
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: editor
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
      - object: document:3
        relation: owner
        user: cheetah
      - object: document:4
        relation: writer
        user: duck
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: true
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: true
      - tuple:
          object: document:4
          relation: viewer
          user: duck
        expectation: true

  - name: ExclusionAndExclusionInBase
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as (writer but not editor) but not owner
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: owner
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: false
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: true

  - name: ExclusionAndExclusionInSubtract
    model: |
      type document
        relations
          define writer as self
          define editor as self
          define owner as self
          define viewer as writer but not (editor but not owner)
    tuples:
      - object: document:1
        relation: writer
        user: aardvark
      - object: document:1
        relation: editor
        user: aardvark
      - object: document:1
        relation: owner
        user: aardvark
      - object: document:2
        relation: writer
        user: badger
      - object: document:2
        relation: editor
        user: badger
      - object: document:3
        relation: writer
        user: cheetah
      - object: document:3
        relation: owner
        user: cheetah
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: aardvark
        expectation: true
      - tuple:
          object: document:2
          relation: viewer
          user: badger
        expectation: false
      - tuple:
          object: document:3
          relation: viewer
          user: cheetah
        expectation: true

  - name: userset_as_user
    model: |
      type group
        relations
          define member as self
      
      type document
        relations
          define viewer as self
    tuples:
      - object: document:1
        relation: viewer
        user: group:x#member
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: group:x#member
        expectation: true

  - name: wildcard_direct
    model: |
      type document
        relations
          define viewer as self
    tuples:
      - object: document:public
        relation: viewer
        user: "*"
    assertions:
      - tuple:
          object: document:public
          relation: viewer
          user: aardvark
        expectation: true

  - name: typed_wildcard_string_is_treated_as_a_literal
    model: |
      type document
        relations
          define viewer as self
    tuples:
      - object: document:1
        relation: viewer
        user: user:*
    assertions:
      - tuple:
          object: document:1
          relation: viewer
          user: user:*
        expectation: true
      - tuple:
          object: document:1
          relation: viewer
          user: user:aardvark
        expectation: false
  - name: concurrency_problem
    model: |
      type feature
        relations
          define access as subscriber_member from associated_plan
          define associated_plan as self
          define subscriber as subscriber from associated_plan
      type feature_repo
        relations
          define feature as self
      type integrity
        relations
          define member as self and member_in_context
          define member_in_context as self
      type org
        relations
          define admin as self and member
          define member as self and member from user_repo and user_in_context
          define user_in_context as self
          define user_repo as self
      type permission
        relations
          define access as access from associated_feature and member from associated_permission_group
          define associated_feature as self
          define associated_permission_group as self
          define org_access as subscriber from associated_feature
      type permission_group
        relations
          define member as self or admin from owner
          define owner as self
      type plan
        relations
          define associated_plan_group as self
          define subscriber as subscriber from associated_plan_group
          define subscriber_member as member from associated_plan_group
      type plan_group
        relations
          define member as member from subscriber
          define plan_access as plan from plan_provider
          define plan_provider as self
          define subscriber as self
      type plan_provider
        relations
          define plan as self and plan from plan_repo
          define plan_repo as self
      type plan_repo
        relations
          define plan as self
      type user
        relations
          define nil as self
      type user_repo
        relations
          define integrity as self
          define member as self and member from integrity

    tuples:
      - object: org:global
        relation: user_repo
        user: user_repo:global
      - object: plan_repo:global
        relation: plan
        user: plan:*
      - object: plan_repo:global
        relation: plan
        user: plan:free
      - object: plan_repo:global
        relation: plan
        user: plan:basic
      - object: plan_repo:global
        relation: plan
        user: plan:pro
      - object: plan_provider:global
        relation: plan_repo
        user: plan_repo:global
      - object: plan_provider:global
        relation: plan
        user: plan:*
      - object: plan_provider:mapped
        relation: plan_repo
        user: plan_repo:global
      - object: plan_provider:azure
        relation: plan_repo
        user: plan_repo:global
      - object: plan_provider:mapped
        relation: plan
        user: plan:free
      - object: plan_provider:mapped
        relation: plan
        user: plan:basic
      - object: plan_provider:mapped
        relation: plan
        user: plan:pro
      - object: plan_provider:azure
        relation: plan
        user: plan:pro
      - object: permission:orgs_micro/status
        relation: associated_feature
        user: feature:status
      - object: permission:orgs_micro/org/create
        relation: associated_feature
        user: feature:orgs_micro
      - object: permission:orgs_micro/user/add
        relation: associated_feature
        user: feature:orgs_micro
      - object: permission_group:*/all
        relation: owner
        user: org:global
      - object: permission_group:*/all
        relation: member
        user: user_repo:*#member
      - object: permission:orgs_micro/org/create
        relation: associated_permission_group
        user: permission_group:*/all
      - object: permission:orgs_micro/status
        relation: associated_permission_group
        user: permission_group:*/all
      - object: feature:orgs_micro/orgs/*
        relation: associated_plan
        user: plan:global
      - object: feature_repo:*
        relation: feature
        user: feature:status
      - object: feature_repo:*
        relation: feature
        user: feature:orgs_micro
      - object: feature:status
        relation: associated_plan
        user: plan:global
      - object: plan_group:*/*
        relation: plan_provider
        user: plan_provider:global
      - object: plan_group:*/*
        relation: subscriber
        user: org:global
      - object: plan:*
        relation: associated_plan_group
        user: plan_group:*/*
      - object: user_repo:*
        relation: member
        user: user:e2e6d1a72e9541dfa8bd5ae39b154751
      - object: org:*
        relation: member
        user: user:e2e6d1a72e9541dfa8bd5ae39b154751
      - object: integrity:71ccb2aad9fb4c88a2926aafa4490cdc
        relation: member
        user: user:e2e6d1a72e9541dfa8bd5ae39b154751
      - object: user_repo:*
        relation: integrity
        user: integrity:71ccb2aad9fb4c88a2926aafa4490cdc
      - object: org:32b0ea4c91b34c2a82fb5dba6e93ee68
        relation: user_repo
        user: user_repo:global
      - object: org:32b0ea4c91b34c2a82fb5dba6e93ee68
        relation: member
        user: user:e2e6d1a72e9541dfa8bd5ae39b154751
      - object: permission_group:32b0ea4c91b34c2a82fb5dba6e93ee68/all
        relation: owner
        user: org:32b0ea4c91b34c2a82fb5dba6e93ee68
      - object: permission_group:32b0ea4c91b34c2a82fb5dba6e93ee68/all
        relation: member
        user: org:32b0ea4c91b34c2a82fb5dba6e93ee68#member
      - object: permission_group:32b0ea4c91b34c2a82fb5dba6e93ee68/admins
        relation: owner
        user: org:32b0ea4c91b34c2a82fb5dba6e93ee68
      - object: permission:orgs_micro/users/add
        relation: associated_permission_group
        user: permission_group:32b0ea4c91b34c2a82fb5dba6e93ee68/admins
      - object: permission_group:32b0ea4c91b34c2a82fb5dba6e93ee68/admins
        relation: member
        user: user:e2e6d1a72e9541dfa8bd5ae39b154751
      - object: permission_group:32b0ea4c91b34c2a82fb5dba6e93ee68/5f0ab6b678e2487db7da439f3a8e6b2a
        relation: owner
        user: org:32b0ea4c91b34c2a82fb5dba6e93ee68
      - object: permission_group:32b0ea4c91b34c2a82fb5dba6e93ee68/5f0ab6b678e2487db7da439f3a8e6b2a
        relation: member
        user: user:e2e6d1a72e9541dfa8bd5ae39b154751
      - object: feature_repo:*
        relation: feature
        user: feature:16943b70c18247e5987e73950b37c935
      - object: permission:cca3c218f84e4de79f0042b120611424
        relation: associated_feature
        user: feature:16943b70c18247e5987e73950b37c935
      - object: plan_repo:*
        relation: plan
        user: plan:d7f09078edfc457fadf1b9c584b630e5
      - object: feature:16943b70c18247e5987e73950b37c935
        relation: associated_plan
        user: plan:d7f09078edfc457fadf1b9c584b630e5
      - object: plan_provider:6e8c2b6ac258431a8c62b569b3ad7d91
        relation: plan_repo
        user: plan_repo:global
      - object: plan_provider:78502680eb5c43ccb1d51c8bc4917521
        relation: plan_repo
        user: plan_repo:global
      - object: plan_provider:6e8c2b6ac258431a8c62b569b3ad7d91
        relation: plan
        user: plan:d7f09078edfc457fadf1b9c584b630e5
      - object: plan_provider:78502680eb5c43ccb1d51c8bc4917521
        relation: plan
        user: plan:d7f09078edfc457fadf1b9c584b630e5
      - object: plan_group:32b0ea4c91b34c2a82fb5dba6e93ee68/6e8c2b6ac258431a8c62b569b3ad7d91
        relation: subscriber
        user: org:32b0ea4c91b34c2a82fb5dba6e93ee68
      - object: plan_group:32b0ea4c91b34c2a82fb5dba6e93ee68/6e8c2b6ac258431a8c62b569b3ad7d91
        relation: plan_provider
        user: plan_provider:6e8c2b6ac258431a8c62b569b3ad7d91
      - object: plan_group:32b0ea4c91b34c2a82fb5dba6e93ee68/78502680eb5c43ccb1d51c8bc4917521
        relation: subscriber
        user: org:32b0ea4c91b34c2a82fb5dba6e93ee68
      - object: plan_group:32b0ea4c91b34c2a82fb5dba6e93ee68/78502680eb5c43ccb1d51c8bc4917521
        relation: plan_provider
        user: plan_provider:78502680eb5c43ccb1d51c8bc4917521
      - object: plan:d7f09078edfc457fadf1b9c584b630e5
        relation: associated_plan_group
        user: plan_group:32b0ea4c91b34c2a82fb5dba6e93ee68/6e8c2b6ac258431a8c62b569b3ad7d91
      - object: plan:d7f09078edfc457fadf1b9c584b630e5
        relation: associated_plan_group
        user: plan_group:32b0ea4c91b34c2a82fb5dba6e93ee68/78502680eb5c43ccb1d51c8bc4917521
      - object: permission:cca3c218f84e4de79f0042b120611424
        relation: associated_permission_group
        user: permission_group:32b0ea4c91b34c2a82fb5dba6e93ee68/5f0ab6b678e2487db7da439f3a8e6b2a
    assertions:
      - tuple:
          object: permission:cca3c218f84e4de79f0042b120611424
          relation: access
          user: user:e2e6d1a72e9541dfa8bd5ae39b154751
        contextualTuples:
          - object: integrity:71ccb2aad9fb4c88a2926aafa4490cdc
            relation: member_in_context
            user: user:e2e6d1a72e9541dfa8bd5ae39b154751
          - object: org:32b0ea4c91b34c2a82fb5dba6e93ee68
            relation: user_in_context
            user: user:e2e6d1a72e9541dfa8bd5ae39b154751
        expectation: true